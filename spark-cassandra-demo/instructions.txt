Start Cassandra Clsuter / Standalone Node


CREATE KEYSPACE capstone WITH replication = {'class': 'SimpleStrategy','replication_factor': 1}


CREATE TABLE carddetails (
	cardId bigint,
	customerId bigint,
	bank text,
	type text,
	nameOnCard text,
	expiryMonth int,
	expiryYear int,
	cardNum text,
	cardLimit float,
	PRIMARY KEY ((cardId),bank));
	

CREATE TABLE customer (
	customerid bigint PRIMARY KEY,
	name text,
	mobilenumber text,
	gender text,
	birthdate bigint,
	email text,
	address text,
	state text,
	country text,
	pincode text );
	
	

CREATE TABLE merchant (
	merchantid bigint PRIMARY KEY,
	merchantname text,
	mobilenumber text,
	startdate bigint,
	email text,
	address text,
	state text,
	country text,
	pincode text,
	merchanttype int,
	segment text,
	taxRegNum text,
	description text
	 );


CREATE TABLE capstone.transaction (
    transactionid bigint PRIMARY KEY,
    customerid bigint,
    invoiceamount float,
    invoicenumber text,
    merchantid bigint,
    status text,
    timestamp bigint
);


CREATE TABLE customer_transaction (
    customerid bigint PRIMARY KEY,
    ordersuccesscounter counter,
    ordercancelcounter counter,
    orderbelow500 counter,
    orderbelow1000 counter,
    orderbelow2000 counter,
    orderabove2000 counter
);

CREATE TABLE merchant_transaction (
    merchantid bigint PRIMARY KEY,
    ordersuccesscounter counter,
    ordercancelcounter counter,
    orderbelow500 counter,
    orderbelow1000 counter,
    orderbelow2000 counter,
    orderabove2000 counter
);

CREATE TABLE daily_transaction (
    date text PRIMARY KEY,
    ordersuccesscounter counter,
    ordercancelcounter counter,
    orderbelow500 counter,
    orderbelow1000 counter,
    orderbelow2000 counter,
    orderabove2000 counter
);

CREATE MATERIALIZED VIEW bank_by_customer AS  SELECT customerId,bank FROM carddetails WHERE customerId is not null and bank is not null PRIMARY KEY ((customerId),bank,cardId);



CREATE TABLE bank_merchant_transaction (
    date text,
    bank text,
    merchantid bigint,
    totalamount float,
    ordercount int,
    PRIMARY KEY ((date),bank,merchantid)
);


//Not in use
CREATE TABLE bank_total_transaction (
    date text,
    bank text,
    totalAmount float,
    PRIMARY KEY ((date,bank),totalAmount)
);


spark-submit --class com.edureka.capstone.jobs.BankMerchantAggregation /Users/raghugupta/Documents/gitrepo/capstone/spark-cassandra-demo/target/spark-cassandra-demo-0.0.1-SNAPSHOT-jar-with-dependencies.jar

//http://msvaljek.blogspot.in/2015/12/stream-processing-with-spring-kafka_13.html